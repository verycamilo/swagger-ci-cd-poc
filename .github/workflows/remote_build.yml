on:
  repository_dispatch:
    types: [process_openapi]

jobs:
  process_openapi:
    runs-on: ubuntu-latest    
    steps:      
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.SPECS_REPO_PAT }}
      - name: Store Spec
        run: |
          mkdir -p specs/${{ github.event.client_payload.service }}/${{ github.event.client_payload.version }}
          echo "${{ github.event.client_payload.doc }}" | base64 -d > specs/${{ github.event.client_payload.service }}/${{ github.event.client_payload.version }}/openapi.yml
          cp template.tmpl specs/${{ github.event.client_payload.service }}/${{ github.event.client_payload.version }}/index.html
      - name: Push Documentation

        run: |
          git config --global user.email "redwolf@vizio.com"
          git config --global user.name "Redwolf CI"
          git add ${{ github.event.client_payload.service }}/${{ github.event.client_payload.version }}/.
          git commit -am "New version of ${{ github.event.client_payload.service }} documentation"
          git push origin main
